class g{pending;waiting;constructor(){this.pending=[],this.waiting=[]}send(b){if(this.waiting.length>0){this.waiting.shift()(b);return}this.pending.push(b)}async recv(){return new Promise((b,f)=>{if(this.pending.length>0){b(this.pending.shift());return}this.waiting.push(b)})}}class j{inner;constructor(b){this.inner=new WeakRef(b)}rustSend(b){let f=this.inner.deref();if(f)f.rustSend(b)}async rustRecv(){let b=this.inner.deref();if(b)return await b.rustRecv()}}class A{weak(){return new j(this)}}class O{id;data;constructor(b,f,w){this.id=b,this.data={method:f,data:w}}}window.__msg_queues=window.__msg_queues||[];window.finalizationRegistry=window.finalizationRegistry||new FinalizationRegistry(({id:b})=>{window.ipc.postMessage(JSON.stringify({method:"query",params:new O(b,"drop")}))});window.getQuery=function(b){return window.__msg_queues[b]};window.createQuery=function(b){return new p(b)};class p extends A{rust_to_js;request_id;constructor(b){super();this.rust_to_js=new g,this.request_id=b,window.__msg_queues[b]=this.weak(),window.finalizationRegistry.register(this,{id:b})}async recv(){return await this.rust_to_js.recv()}send(b){window.ipc.postMessage(JSON.stringify({method:"query",params:new O(this.request_id,"send",b)}))}rustSend(b){this.rust_to_js.send(b)}async rustRecv(){}}export{p as NativeDioxusChannel};

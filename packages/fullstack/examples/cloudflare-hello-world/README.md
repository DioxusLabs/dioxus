# cloudflare-hello-world example

The `cloudflare` feature is designed to deploy to Cloudflare Pages.
Cloudflare's serverless platform includes Workers and Pages Functions, with Workers being purely serverless functions
and Pages being a combination of static asset delivery and serverless functions.
Therefore, Pages Functions are appropriate for deploying Dioxus Fullstack applications.

## Getting Started

```bash
bun install
bun run postinstall
```

## Development

```bash
bun run serve
```

## Deployment

```bash
bun run build && bun run deploy
```

## Files

- `public/404.html`
   - Required to disable [SPA rendering](https://developers.cloudflare.com/pages/configuration/serving-pages/#single-page-application-spa-rendering).
- `public/_worker.js`
   - Required to enable [Advanced mode](https://developers.cloudflare.com/pages/functions/advanced-mode/) for Functions.
- `Dioxus.toml`
   - Required to disable `index_on_404`.
- `wrangler.toml`
   - Required to customize Wrangler's server building process. (we need to specify '--features server' flag)

## Tips

- Devtools can be started with the `d` key while Wrangler is running to check server logs, etc.
  The stack trace of panic is especially difficult to see without Devtools.

## Issues

- Sometimes `dx` process remains when `wrangler pages dev` is terminated.
- When `wrangler pages dev` exits, sometimes the socket that `dx serve` is listening on remains, 
  which seems to be a problem with `wrangler` since `dx` by itself has no problem.

## Future works

- [ ] Make IncrementalRenderer cache pluggable and Cloudflare adapter can uses KV
- [ ] Hot Reload support
   - Functions had no file system access, but supported WebSocket client/server.
     Hot Reload can be supported by Functions relaying communication with Hot Reload server on `dx serve`.
- [ ] Don't deploy `index.html`
   - `index.html` is not needed because it is generated by SSR. However, the `index.html` is needed when building the
     server, and a `dx build` is required before the first serve; by making the CLI's `index.html` generation code a
     library, this preparation becomes unnecessary. 

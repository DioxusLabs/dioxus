function main(addr){let root=window.document.getElementById("main");if(root!=null)window.ipc=new IPC(root,addr)}class IPC{ws;constructor(root,addr){window.interpreter.initialize(root),window.interpreter.liveview=!0,window.interpreter.ipc=this;const ws=new WebSocket(addr);ws.binaryType="arraybuffer";function ping(){ws.send("__ping__")}ws.onopen=()=>{setInterval(ping,30000),ws.send(window.interpreter.serializeIpcMessage("initialize"))},ws.onerror=(err)=>{},ws.onmessage=(message)=>{const binaryFrame=new Uint8Array(message.data)[0]==1,messageData=message.data.slice(1);if(binaryFrame)window.interpreter.run_from_bytes(messageData);else{let str=new TextDecoder("utf-8").decode(messageData);if(str!="__pong__"){const event=JSON.parse(str);switch(event.type){case"query":Function("Eval",`"use strict";${event.data};`)();break}}}},this.ws=ws}postMessage(msg){this.ws.send(msg)}}export{main};
